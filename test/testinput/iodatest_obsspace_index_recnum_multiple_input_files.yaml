---
time window:
  begin: "2022-02-15T21:00:00Z"
  end: "2022-02-16T03:00:00Z"

observations:
- obs space:
    name: "Grouping, single file input"
    simulated variables: ['airTemperature']
    obsdatain:
      engine:
        type: H5File
        obsfile: "Data/testinput_tier_1/obsspace_grouping_multiple_input_files.nc4"
      obsgrouping:
        group variables: [ "group_by_int" ]

  test data:
    gnlocs: 15
    gnlocs outside time window: 0
    nlocs: 15
    nrecs: 10
    obs are sorted: false
    mpi size1:
      rank0:
        index: [ 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14 ]
        recnum: [ 0, 1, 1, 2, 3, 0, 4, 5, 6, 7, 5, 8, 9, 8, 9 ]
        recidx:
          rec0: [ 0, 5 ]
          rec1: [ 1, 2 ]
          rec2: [ 3 ]
          rec3: [ 4 ]
          rec4: [ 6 ]
          rec5: [ 7, 10 ]
          rec6: [ 8 ]
          rec7: [ 9 ]
          rec8: [ 11, 13 ]
          rec9: [ 12, 14 ]

    mpi size2:
      rank0:
        index: [ 0, 3, 5, 6, 8, 11, 13 ]
        recnum: [ 0, 2, 0, 4, 6, 8, 8 ]
        recidx:
          rec0: [ 0, 2 ]
          rec2: [ 1 ]
          rec4: [ 3 ]
          rec6: [ 4 ]
          rec8: [ 5, 6 ]
      rank1:
        index: [ 1, 2, 4, 7, 9, 10, 12, 14 ]
        recnum: [ 1, 1, 3, 5, 7, 5, 9, 9 ]
        recidx:
          rec1: [ 0, 1 ]
          rec3: [ 2 ]
          rec5: [ 3, 5 ]
          rec7: [ 4 ]
          rec9: [ 6, 7 ]

    mpi size4:
      rank0:
        index: [ 0, 5, 6, 11, 13 ]
        recnum: [ 0, 0, 4, 8, 8 ]
        recidx:
          rec0: [ 0, 1 ]
          rec4: [ 2 ]
          rec8: [ 3, 4 ]
      rank1:
        index: [ 1, 2, 7, 10, 12, 14 ]
        recnum: [ 1, 1, 5, 5, 9, 9 ]
        recidx:
          rec1: [ 0, 1 ]
          rec5: [ 2, 3 ]
          rec9: [ 4, 5 ]
      rank2:
        index: [ 3, 8 ]
        recnum: [ 2, 6 ]
        recidx:
          rec2: [ 0 ]
          rec6: [ 1 ]
      rank3:
        index: [ 4, 9 ]
        recnum: [ 3, 7 ]
        recidx:
          rec3: [ 0 ]
          rec7: [ 1 ]

- obs space:
    name: "Grouping, multiple file input"
    simulated variables: ['airTemperature']
    obsdatain:
      engine:
        type: H5File
        obsfiles:
        - "Data/testinput_tier_1/obsspace_grouping_multiple_input_files_p1.nc4"
        - "Data/testinput_tier_1/obsspace_grouping_multiple_input_files_p2.nc4"
        - "Data/testinput_tier_1/obsspace_grouping_multiple_input_files_p3.nc4"
      obsgrouping:
        group variables: [ "group_by_int" ]

  test data:
    gnlocs: 15
    gnlocs outside time window: 0
    nlocs: 15
    nrecs: 10
    obs are sorted: false
    mpi size1:
      rank0:
        index: [ 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14 ]
        recnum: [ 0, 1, 1, 2, 3, 0, 4, 5, 6, 7, 5, 8, 9, 8, 9 ]
        recidx:
          rec0: [ 0, 5 ]
          rec1: [ 1, 2 ]
          rec2: [ 3 ]
          rec3: [ 4 ]
          rec4: [ 6 ]
          rec5: [ 7, 10 ]
          rec6: [ 8 ]
          rec7: [ 9 ]
          rec8: [ 11, 13 ]
          rec9: [ 12, 14 ]

    mpi size2:
      rank0:
        index: [ 0, 3, 5, 6, 8, 11, 13 ]
        recnum: [ 0, 2, 0, 4, 6, 8, 8 ]
        recidx:
          rec0: [ 0, 2 ]
          rec2: [ 1 ]
          rec4: [ 3 ]
          rec6: [ 4 ]
          rec8: [ 5, 6 ]
      rank1:
        index: [ 1, 2, 4, 7, 9, 10, 12, 14 ]
        recnum: [ 1, 1, 3, 5, 7, 5, 9, 9 ]
        recidx:
          rec1: [ 0, 1 ]
          rec3: [ 2 ]
          rec5: [ 3, 5 ]
          rec7: [ 4 ]
          rec9: [ 6, 7 ]

    mpi size4:
      rank0:
        index: [ 0, 5, 6, 11, 13 ]
        recnum: [ 0, 0, 4, 8, 8 ]
        recidx:
          rec0: [ 0, 1 ]
          rec4: [ 2 ]
          rec8: [ 3, 4 ]
      rank1:
        index: [ 1, 2, 7, 10, 12, 14 ]
        recnum: [ 1, 1, 5, 5, 9, 9 ]
        recidx:
          rec1: [ 0, 1 ]
          rec5: [ 2, 3 ]
          rec9: [ 4, 5 ]
      rank2:
        index: [ 3, 8 ]
        recnum: [ 2, 6 ]
        recidx:
          rec2: [ 0 ]
          rec6: [ 1 ]
      rank3:
        index: [ 4, 9 ]
        recnum: [ 3, 7 ]
        recidx:
          rec3: [ 0 ]
          rec7: [ 1 ]
